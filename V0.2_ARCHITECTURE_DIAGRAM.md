# V0.2 Architecture Diagram

## 🏗️ 전체 시스템 아키텍처

```mermaid
graph TB
    %% 사용자 레이어
    subgraph "User Layer"
        UI[React Web UI]
        Mobile[Mobile App]
        CLI[CLI Interface]
        API_Client[API Clients]
    end
    
    %% API 게이트웨이 레이어
    subgraph "API Gateway"
        Gateway[API Gateway]
        Auth[Authentication]
        RateLimit[Rate Limiting]
        LoadBalancer[Load Balancer]
    end
    
    %% 백엔드 서비스 레이어
    subgraph "Backend Services"
        FastAPI[FastAPI Server]
        GraphQL[GraphQL Endpoint]
        WebSocket[WebSocket Server]
        TaskQueue[Task Queue]
    end
    
    %% AI/ML 레이어
    subgraph "AI/ML Layer"
        LangGraph[LangGraph Agent]
        MLModels[ML Models]
        VectorDB[Vector Database]
        ModelServing[Model Serving]
    end
    
    %% 데이터 레이어
    subgraph "Data Layer"
        PostgreSQL[(PostgreSQL)]
        Redis[(Redis Cache)]
        TimeSeries[(Time Series DB)]
        ObjectStore[(Object Storage)]
    end
    
    %% 외부 API 레이어
    subgraph "External APIs"
        WeatherAPI[Weather APIs]
        FlightAPI[Flight APIs]
        CryptoAPI[Crypto APIs]
        NewsAPI[News APIs]
    end
    
    %% 블록체인 레이어
    subgraph "Blockchain Layer"
        Solana[Solana Network]
        Pyth[Pyth Oracle]
        Chainlink[Chainlink Oracle]
        SmartContract[Smart Contracts]
    end
    
    %% 모니터링 레이어
    subgraph "Monitoring Layer"
        Prometheus[Prometheus]
        Grafana[Grafana]
        Sentry[Sentry]
        Logs[Log Aggregation]
    end
    
    %% 연결 관계
    UI --> Gateway
    Mobile --> Gateway
    CLI --> Gateway
    API_Client --> Gateway
    
    Gateway --> Auth
    Gateway --> RateLimit
    Gateway --> LoadBalancer
    
    LoadBalancer --> FastAPI
    LoadBalancer --> GraphQL
    LoadBalancer --> WebSocket
    
    FastAPI --> LangGraph
    FastAPI --> PostgreSQL
    FastAPI --> Redis
    FastAPI --> TaskQueue
    
    LangGraph --> MLModels
    LangGraph --> VectorDB
    LangGraph --> SmartContract
    
    MLModels --> ModelServing
    TaskQueue --> WeatherAPI
    TaskQueue --> FlightAPI
    TaskQueue --> CryptoAPI
    
    SmartContract --> Solana
    SmartContract --> Pyth
    SmartContract --> Chainlink
    
    FastAPI --> Prometheus
    FastAPI --> Sentry
    FastAPI --> Logs
```

## 🔄 데이터 플로우 다이어그램

```mermaid
sequenceDiagram
    participant U as User
    participant UI as Web UI
    participant API as FastAPI
    participant LG as LangGraph
    participant ML as ML Models
    participant EXT as External APIs
    participant SC as Smart Contract
    participant SOL as Solana
    
    U->>UI: 보험 상품 생성 요청
    UI->>API: POST /insurance/create
    API->>LG: 에이전트 실행
    
    LG->>ML: 위험도 분석
    ML->>EXT: 실시간 데이터 수집
    EXT-->>ML: 기상/항공 데이터
    ML-->>LG: 위험도 계산 결과
    
    LG->>SC: 스마트 컨트랙트 배포
    SC->>SOL: 컨트랙트 생성
    SOL-->>SC: 트랜잭션 확인
    SC-->>LG: 배포 완료
    
    LG-->>API: 보험 상품 생성 완료
    API-->>UI: 응답 반환
    UI-->>U: 결과 표시
```

## 🏛️ 마이크로서비스 아키텍처

```mermaid
graph TB
    subgraph "Core Services"
        AgentService[Agent Service]
        InsuranceService[Insurance Service]
        UserService[User Service]
        ContractService[Contract Service]
    end
    
    subgraph "Data Services"
        DataIngestionService[Data Ingestion]
        AnalyticsService[Analytics Service]
        MLService[ML Service]
        CacheService[Cache Service]
    end
    
    subgraph "Blockchain Services"
        WalletService[Wallet Service]
        TransactionService[Transaction Service]
        OracleService[Oracle Service]
        MonitoringService[Monitoring Service]
    end
    
    subgraph "External Integrations"
        WeatherService[Weather Service]
        FlightService[Flight Service]
        CryptoService[Crypto Service]
        NotificationService[Notification Service]
    end
    
    subgraph "Infrastructure"
        MessageQueue[Message Queue]
        ServiceMesh[Service Mesh]
        ConfigService[Config Service]
        SecretManager[Secret Manager]
    end
    
    %% 서비스 간 통신
    AgentService --> InsuranceService
    AgentService --> MLService
    InsuranceService --> ContractService
    ContractService --> WalletService
    ContractService --> TransactionService
    
    DataIngestionService --> WeatherService
    DataIngestionService --> FlightService
    DataIngestionService --> CryptoService
    
    MLService --> AnalyticsService
    MLService --> CacheService
    
    OracleService --> MonitoringService
    
    %% 인프라 서비스
    MessageQueue --> AgentService
    MessageQueue --> DataIngestionService
    ServiceMesh --> AgentService
    ServiceMesh --> InsuranceService
```

## 🗄️ 데이터베이스 스키마

```mermaid
erDiagram
    User {
        uuid id PK
        string email
        string wallet_address
        timestamp created_at
        timestamp updated_at
        json profile
    }
    
    Insurance {
        uuid id PK
        uuid user_id FK
        string product_type
        json parameters
        string contract_address
        decimal premium
        decimal coverage
        timestamp created_at
        string status
    }
    
    Event {
        uuid id PK
        string event_type
        json data
        timestamp occurred_at
        string source
        decimal confidence
        string status
    }
    
    Claim {
        uuid id PK
        uuid insurance_id FK
        uuid event_id FK
        decimal amount
        timestamp claimed_at
        timestamp processed_at
        string status
        string transaction_hash
    }
    
    RiskAssessment {
        uuid id PK
        uuid insurance_id FK
        decimal risk_score
        json analysis
        timestamp calculated_at
        string model_version
    }
    
    Transaction {
        uuid id PK
        uuid insurance_id FK
        string transaction_hash
        string transaction_type
        decimal amount
        timestamp timestamp
        string status
        json metadata
    }
    
    User ||--o{ Insurance : owns
    Insurance ||--o{ Claim : has
    Insurance ||--o{ RiskAssessment : has
    Insurance ||--o{ Transaction : has
    Event ||--o{ Claim : triggers
```

## 🔧 기술 스택

### Frontend
- **React 18** - 사용자 인터페이스
- **TypeScript** - 타입 안전성
- **Tailwind CSS** - 스타일링
- **React Query** - 상태 관리
- **Wallet Adapter** - 지갑 연동

### Backend
- **FastAPI** - API 서버
- **Python 3.11** - 백엔드 언어
- **PostgreSQL** - 관계형 데이터베이스
- **Redis** - 캐싱 및 세션
- **Celery** - 비동기 작업 처리

### AI/ML
- **LangGraph** - AI 에이전트
- **LangChain** - LLM 통합
- **Scikit-learn** - 머신러닝
- **TensorFlow** - 딥러닝
- **Pandas** - 데이터 처리

### Blockchain
- **Solana** - 블록체인 네트워크
- **Anchor** - 스마트 컨트랙트 프레임워크
- **Pyth Network** - 가격 오라클
- **Chainlink** - 외부 데이터 오라클

### Infrastructure
- **Docker** - 컨테이너화
- **Kubernetes** - 오케스트레이션
- **AWS/GCP** - 클라우드 플랫폼
- **Prometheus** - 모니터링
- **Grafana** - 대시보드

## 🔐 보안 아키텍처

```mermaid
graph TB
    subgraph "Security Layers"
        WAF[Web Application Firewall]
        DDoS[DDoS Protection]
        SSL[SSL/TLS Encryption]
        
        subgraph "Authentication"
            JWT[JWT Tokens]
            OAuth[OAuth 2.0]
            MFA[Multi-Factor Auth]
        end
        
        subgraph "Authorization"
            RBAC[Role-Based Access]
            API_Keys[API Key Management]
            Permissions[Permission System]
        end
        
        subgraph "Data Protection"
            Encryption[Data Encryption]
            Hashing[Password Hashing]
            PII[PII Protection]
        end
        
        subgraph "Monitoring"
            SIEM[SIEM System]
            Intrusion[Intrusion Detection]
            Audit[Audit Logging]
        end
    end
    
    subgraph "Compliance"
        GDPR[GDPR Compliance]
        SOC2[SOC 2 Compliance]
        ISO27001[ISO 27001]
    end
```

## 🚀 배포 아키텍처

```mermaid
graph TB
    subgraph "Production Environment"
        subgraph "DMZ"
            ALB[Application Load Balancer]
            CDN[CloudFront CDN]
        end
        
        subgraph "Application Tier"
            API1[API Server 1]
            API2[API Server 2]
            API3[API Server 3]
        end
        
        subgraph "Database Tier"
            PG_Master[(PostgreSQL Master)]
            PG_Slave[(PostgreSQL Slave)]
            Redis_Cluster[(Redis Cluster)]
        end
        
        subgraph "Storage Tier"
            S3[Object Storage]
            EBS[Block Storage]
        end
    end
    
    subgraph "Staging Environment"
        Staging_API[Staging API]
        Staging_DB[(Staging DB)]
    end
    
    subgraph "Development Environment"
        Dev_API[Development API]
        Dev_DB[(Development DB)]
    end
    
    CDN --> ALB
    ALB --> API1
    ALB --> API2
    ALB --> API3
    
    API1 --> PG_Master
    API2 --> PG_Master
    API3 --> PG_Master
    
    PG_Master --> PG_Slave
    
    API1 --> Redis_Cluster
    API2 --> Redis_Cluster
    API3 --> Redis_Cluster
```

이 아키텍처는 V0.2에서 구현할 전체 시스템의 구조를 보여주며, 확장 가능하고 안정적인 파라메트릭 보험 플랫폼을 구축하기 위한 설계입니다.